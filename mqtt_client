# To run this file, run in a terminal this command: python mqtt_client.py
# You must have python installed and paho-mqtt (pip install paho-mqtt matplotlib)
import paho.mqtt.client as mqtt
import json
import math
import matplotlib.pyplot as plt

def on_message(client, userdata, msg):
    try:
        data = json.loads(msg.payload.decode())
        print("Received LIDAR data:")
        for p in data:
            angle = p.get("angle")
            distance = p.get("distance")
            quality = p.get("quality")
            print(f"  Angle: {angle}Â°, Distance: {distance}, Quality: {quality}")
        print("-" * 40)
    except Exception as e:
        print("Error parsing message:", e)

# MQTT setup
client = mqtt.Client()
client.connect("broker.hivemq.com", 1883)
client.subscribe("slamaleykoum77/lidardata")
client.on_message = on_message

print("Listening for LIDAR data... (press Ctrl+C to stop)")
try:
    client.loop_forever()
except KeyboardInterrupt:
    print("\nStopped by user.")
    client.disconnect()